# 03.JavaScript 비동기 처리, 콜백 함수

JavaScript 는 싱글 스레드 언어이지만 JavaScript 런타임이 비동기로 동작하기 때문에 비동기 작업을 통해 효율적으로 작업을 처리할 수 있다.
그러나 비동기 처리를 이용하여 작업을 할 때 주의해야 할 점이 있다. 몇몇 작업의 경우 순차적으로 진행되어야 한다. 

예를 들면 외부(서버, 데이터베이스 등)에서 데이터를 불러와서 작업을 해야 하는 상황을 가정해 보자.

```.js
function getData() {
    let data;
    // 데이터를 불러오는 데 3초가 걸린다고 가정
    setTimeout(() => {
        data = 100;
    }, 3000);

    return data;
}


// 데이터 출력
let result = getData()
console.log('result : ', result);
```

위 코드를 실행하면 다음 결과가 나온다.

```.js
result : undefined
```

비동기 처리에 대해 제대로 이해했다면 결과가 왜 이렇게 나오는지 알 것이다. 코드가 실행되다가 setTimeout 함수가 Task Queue 에 들어가고 
3초 후에 콜백 함수가 실행된다. 3초 동안 대기하는 동안 나머지 코드가 실행되는데 data 변수에 값이 할당되지 않은 상태이기 때문에 data 가 undefined 로 출력된다. 
이런 문제를 예방하기 위해서 작업을 동기적으로 처리를 해야할 때가 있다. 가장 기본적으로 콜백 함수를 이용하는 방법이 있다.

방금 전의 예시에서 데이터가 할당되기 전에 작업이 처리되는 문제를 다음과 같은 방식으로 개선할 수 있다.

```.js
function getData(callback) {
    // 3초 후에 데이터 값을 받아온 후, 콜백 함수에 값을 넘겨줌.
    setTimeout(() => {
        let data = 200;
        callback(data);
    }, 3000);
}


getData(function(data) {
  let result = data;
  console.log('result : ', result);
});
```

위 코드를 실행하면 다음 결과가 나온다.

```.js
result : 200
```

getData 에 특정 작업을 진행하는 콜백 함수를 전달해 주고, 3초가 지난 후에 콜백 함수를 실행함으로써 data 값이 할당된 채로 문제없이 작업을 진행할 수 있다. 
